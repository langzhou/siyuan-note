(function(){"use strict";var __webpack_modules__={6418:function(__unused_webpack_module,__webpack_exports__,__webpack_require__){var vue__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(3396);__webpack_exports__["Z"]=(0,vue__WEBPACK_IMPORTED_MODULE_0__.aZ)({name:"App",data(){return{mode:"test2",linksData:{},backlinksExpand:!0,backmentionsExpand:!0,widgetID:"",widget:document.createElement("div")}},methods:{async init(){const e=await this.getDocumentID();if(0==e.code){const n=e["data"][0]["root_id"],t=await this.getBackLinks(n);0==t.code&&(this.linksData=t["data"])}setTimeout((()=>{this.resizeIframe()}),500)},getDocumentID(){const iframe=window.frameElement,parent=iframe?.parentElement?.parentElement,id=parent?parent.dataset.nodeId:"";this.widgetID=id,this.widget=parent,parent&&(this.backlinksExpand=eval(parent.getAttribute("custom-backlinks-expand")||"true"),this.backmentionsExpand=eval(parent.getAttribute("custom-backmentions-expand")||"true"));const url="test"==this.mode?"http://127.0.0.1:6806/api/query/sql":"http://"+window.location.host+"/api/query/sql",sql=`SELECT root_id FROM blocks WHERE id = '${id}'`,data={stmt:sql};return fetch(url,{method:"POST",body:JSON.stringify(data),headers:{"Content-Type":"application/json"}}).then((e=>e.json())).then((e=>e))},getBackLinks(e){const n="test"==this.mode?"http://127.0.0.1:6806/api/ref/getBacklink":"http://"+window.location.host+"/api/ref/getBacklink",t={id:e,beforeLen:10,k:"",mk:""};return fetch(n,{method:"POST",body:JSON.stringify(t),headers:{"Content-Type":"application/json"}}).then((e=>e.json())).then((e=>e))},async saveExpandState(e,n){const t="backlinks"==e?{"custom-backlinks-expand":n.toString()}:{"custom-backmentions-expand":n.toString()};fetch("http://"+window.location.host+"/api/attr/setBlockAttrs",{method:"POST",body:JSON.stringify({id:this.widgetID,attrs:t}),headers:{"Content-Type":"application/json"}}).then((e=>e.json())).catch((e=>{console.log(e)}))},expandAll(e){const n=document.querySelectorAll(`.${e} details`);let t;"backlinks"==e?(t=!this.backlinksExpand,this.backlinksExpand=t):(t=!this.backmentionsExpand,this.backmentionsExpand=t),n.forEach((n=>{const i=n;i.open=t,this.widget.setAttribute(`custom-${e}-expand`,`${t}`)})),this.saveExpandState(e,t)},openNote(e){window.open("siyuan://blocks/"+e,"_blank")},resizeIframe(){const e=window.frameElement,n=window.document.body.scrollHeight;e.style.height=n+50+"px"}},mounted(){this.init()}})},3164:function(e,n,t){var i=t(9242),a=t(3396),c=t(7139);const _={id:"note-backlink"},s={class:"backlinks"},o={class:"title"},r=(0,a._)("span",null,"反向链接",-1),l={key:0},k=["open"],d={key:0,class:"blocks"},u=["onClick"],p=(0,a._)("div",{class:"circle"},null,-1),b=["innerHTML"],w={key:1,class:"children"},h=["onClick"],m=(0,a._)("div",{class:"circle"},null,-1),f=["innerHTML"],g={key:1,class:"empty"},v={class:"backmentions"},D={class:"title"},y=(0,a._)("span",null,"提及",-1),q={key:0},x=["open"],E={key:0,class:"blocks"},O=["onClick"],T=(0,a._)("div",{class:"circle"},null,-1),C=["innerHTML"],H={key:1,class:"children"},L=["onClick"],M=(0,a._)("div",{class:"circle"},null,-1),j=["innerHTML"],S={key:1,class:"empty"};function A(e,n,t,i,A,I){return(0,a.wg)(),(0,a.iD)("div",_,[(0,a._)("div",s,[(0,a._)("div",o,[r,e.linksData.backlinks&&e.linksData.backlinks.length>0?((0,a.wg)(),(0,a.iD)("span",{key:0,class:"btn",onClick:n[0]||(n[0]=n=>e.expandAll("backlinks"))},(0,c.zw)(e.backlinksExpand?"全部折叠":"全部展开"),1)):(0,a.kq)("",!0)]),e.linksData.backlinks&&e.linksData.backlinks.length>0?((0,a.wg)(),(0,a.iD)("div",l,[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(e.linksData.backlinks,(n=>((0,a.wg)(),(0,a.iD)("details",{open:e.backlinksExpand,key:n},[(0,a._)("summary",null,(0,c.zw)(n.name),1),n.blocks?((0,a.wg)(),(0,a.iD)("div",d,[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(n.blocks,(n=>((0,a.wg)(),(0,a.iD)("div",{class:"item",key:n,onClick:t=>e.openNote(n.id)},[p,(0,a._)("div",{innerHTML:n.content,class:"content"},null,8,b)],8,u)))),128))])):(0,a.kq)("",!0),n.children?((0,a.wg)(),(0,a.iD)("div",w,[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(n.children,(n=>((0,a.wg)(),(0,a.iD)("div",{class:"item",key:n,onClick:t=>e.openNote(n.id)},[m,(0,a._)("div",{innerHTML:n.name,class:"content"},null,8,f)],8,h)))),128))])):(0,a.kq)("",!0)],8,k)))),128))])):((0,a.wg)(),(0,a.iD)("div",g,"暂无内容"))]),(0,a._)("div",v,[(0,a._)("div",D,[y,e.linksData.backmentions&&e.linksData.backmentions.length>0?((0,a.wg)(),(0,a.iD)("span",{key:0,class:"btn",onClick:n[1]||(n[1]=n=>e.expandAll("backmentions"))},(0,c.zw)(e.backmentionsExpand?"全部折叠":"全部展开"),1)):(0,a.kq)("",!0)]),e.linksData.backmentions&&e.linksData.backmentions.length>0?((0,a.wg)(),(0,a.iD)("div",q,[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(e.linksData.backmentions,(n=>((0,a.wg)(),(0,a.iD)("details",{open:e.backmentionsExpand,key:n},[(0,a._)("summary",null,(0,c.zw)(n.name),1),n.blocks?((0,a.wg)(),(0,a.iD)("div",E,[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(n.blocks,(n=>((0,a.wg)(),(0,a.iD)("div",{class:"item",key:n,onClick:t=>e.openNote(n.id)},[T,(0,a._)("div",{innerHTML:n.content,class:"content"},null,8,C)],8,O)))),128))])):(0,a.kq)("",!0),n.children?((0,a.wg)(),(0,a.iD)("div",H,[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(n.children,(n=>((0,a.wg)(),(0,a.iD)("div",{class:"item",key:n,onClick:t=>e.openNote(n.id)},[M,(0,a._)("div",{innerHTML:n.name,class:"content"},null,8,j)],8,L)))),128))])):(0,a.kq)("",!0)],8,x)))),128))])):((0,a.wg)(),(0,a.iD)("div",S,"暂无内容"))])])}var I=t(6418),P=t(89);const K=(0,P.Z)(I.Z,[["render",A]]);var N=K;(0,i.ri)(N).mount("#app")}},__webpack_module_cache__={};function __webpack_require__(e){var n=__webpack_module_cache__[e];if(void 0!==n)return n.exports;var t=__webpack_module_cache__[e]={exports:{}};return __webpack_modules__[e](t,t.exports,__webpack_require__),t.exports}__webpack_require__.m=__webpack_modules__,function(){var e=[];__webpack_require__.O=function(n,t,i,a){if(!t){var c=1/0;for(r=0;r<e.length;r++){t=e[r][0],i=e[r][1],a=e[r][2];for(var _=!0,s=0;s<t.length;s++)(!1&a||c>=a)&&Object.keys(__webpack_require__.O).every((function(e){return __webpack_require__.O[e](t[s])}))?t.splice(s--,1):(_=!1,a<c&&(c=a));if(_){e.splice(r--,1);var o=i();void 0!==o&&(n=o)}}return n}a=a||0;for(var r=e.length;r>0&&e[r-1][2]>a;r--)e[r]=e[r-1];e[r]=[t,i,a]}}(),function(){__webpack_require__.n=function(e){var n=e&&e.__esModule?function(){return e["default"]}:function(){return e};return __webpack_require__.d(n,{a:n}),n}}(),function(){__webpack_require__.d=function(e,n){for(var t in n)__webpack_require__.o(n,t)&&!__webpack_require__.o(e,t)&&Object.defineProperty(e,t,{enumerable:!0,get:n[t]})}}(),function(){__webpack_require__.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){__webpack_require__.o=function(e,n){return Object.prototype.hasOwnProperty.call(e,n)}}(),function(){var e={143:0};__webpack_require__.O.j=function(n){return 0===e[n]};var n=function(n,t){var i,a,c=t[0],_=t[1],s=t[2],o=0;if(c.some((function(n){return 0!==e[n]}))){for(i in _)__webpack_require__.o(_,i)&&(__webpack_require__.m[i]=_[i]);if(s)var r=s(__webpack_require__)}for(n&&n(t);o<c.length;o++)a=c[o],__webpack_require__.o(e,a)&&e[a]&&e[a][0](),e[a]=0;return __webpack_require__.O(r)},t=self["webpackChunknote_backlink"]=self["webpackChunknote_backlink"]||[];t.forEach(n.bind(null,0)),t.push=n.bind(null,t.push.bind(t))}();var __webpack_exports__=__webpack_require__.O(void 0,[998],(function(){return __webpack_require__(3164)}));__webpack_exports__=__webpack_require__.O(__webpack_exports__)})();